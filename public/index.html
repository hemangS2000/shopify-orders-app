<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shopify Orders</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .order { margin-bottom: 15px; border: 1px solid #ccc; padding: 10px; }
    .json-data { white-space: pre-wrap; background: #f4f4f4; padding: 10px; display: none; }
  </style>
</head>
<body>
  <h1>Shopify Orders</h1>
  <div id="orders"></div>

  <script>
    fetch('/orders')
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById('orders');
        data.forEach(order => {
          const div = document.createElement('div');
          div.className = 'order';
          div.innerHTML = `
            <strong>Order ID:</strong> ${order.id} 
            <button onclick="toggleJson('${order.id}')">Show JSON</button>
            <div id="json-${order.id}" class="json-data">${order.json_data}</div>
          `;
          container.appendChild(div);
        });
      });

    function toggleJson(id) {
      const el = document.getElementById('json-' + id);
      el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }
  </script>

<script>
    // This function runs after the page loads
    window.onload = function () {
      fetch('/orders')
        .then(response => response.json())
        .then(data => {
          const container = document.getElementById('orders-container');
  
          if (data.length === 0) {
            container.innerHTML = '<p>No orders found.</p>';
            return;
          }
  
          data.forEach(order => {
            const wrapper = document.createElement('div');
            wrapper.style.border = '1px solid #ccc';
            wrapper.style.marginBottom = '1em';
            wrapper.style.padding = '1em';
  
            const title = document.createElement('h3');
            title.innerText = 'Order ID: ' + order.id;
  
            const button = document.createElement('button');
            button.innerText = 'View JSON';
            button.onclick = function () {
              const pre = document.createElement('pre');
              pre.innerText = order.json_data;
              wrapper.appendChild(pre);
              button.remove(); // remove button after click
            };
  
            wrapper.appendChild(title);
            wrapper.appendChild(button);
            container.appendChild(wrapper);
          });
        })
        .catch(err => {
          document.getElementById('orders-container').innerHTML = '<p>Error loading orders.</p>';
          console.error(err);
        });
    };
  </script>
  


</body>
</html>
