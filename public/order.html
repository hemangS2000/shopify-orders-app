<!DOCTYPE html>
<html>
<head>
  <title>Shopify Orders</title>
  <style>
    /* Same styles as before */
    .json-modal {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 20px;
      border: 1px solid #ccc;
      max-width: 400px;
      max-height: 80vh;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h2>Latest Shopify Orders</h2>
  <div id="orders-container"></div>
  <div id="json-modal" class="json-modal" style="display: none;"></div>

  <script>
    const modal = document.getElementById('json-modal');
    let eventSource;

    function loadOrders() {
      fetch('/api/orders')
  .then(r => r.json())
  .then(orders => {
          const html = `
            <table>
              <thead>...</thead>
              <tbody>
                ${orders.map(order => `
                  <tr>
                    <!-- Your existing columns -->
                    <td>
                      <button onclick="showOrderDetails('${order.id}')">
                        Show Details
                      </button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>`;
          document.getElementById('orders-container').innerHTML = html;
        });
    }

    function showOrderDetails(orderId) {
      fetch(`/api/orders/${orderId}`)
        .then(r => r.json())
        .then(order => {
          modal.style.display = 'block';
          modal.innerHTML = `
            <pre>${JSON.stringify({
              name: order.shipping_address?.name,
              email: order.customer?.email,
              phone: order.shipping_address?.phone,
              shipping_code: order.shipping_lines?.[0]?.code
            }, null, 2)}</pre>
            <button onclick="modal.style.display='none'">Close</button>
          `;
        });
    }

    // SSE listener
    eventSource = new EventSource('/events');
    eventSource.onmessage = () => loadOrders();

    // Initial load
    loadOrders();
  </script>
</body>
</html>